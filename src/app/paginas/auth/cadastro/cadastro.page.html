<ion-content class="cadastro-content">
  <div class="content-card">
    <div class="custom-header">
      <ion-button class="custom-back-button" fill="clear" (click)="goBack()">
        <ion-icon slot="icon-only" name="arrow-back"></ion-icon>
      </ion-button>
      <h1 class="page-title">Cadastro</h1>
    </div>

    <form [formGroup]="cadastroForm" (ngSubmit)="fazerCadastro()">
      <div class="form-container">
        <app-custom-input
          label="Nome"
          formControlName="nome"
          type="text"
          placeholder="Seu nome completo"
          [errorMessage]="cadastroForm.get('nome')?.touched && cadastroForm.get('nome')?.invalid ? 'Nome é obrigatório.' : null"
        ></app-custom-input>

        <app-custom-input
          label="Email"
          formControlName="email"
          type="email"
          placeholder="email@exemplo.com"
          [errorMessage]="
            cadastroForm.get('email')?.touched
              ? (cadastroForm.get('email')?.hasError('required') ? 'Email é obrigatório.' : cadastroForm.get('email')?.hasError('email') ? 'Email inválido.' : null)
              : null
          "
        ></app-custom-input>

        <app-custom-input
          label="Data de Nascimento"
          formControlName="dataDeNascimento"
          type="date"
          [errorMessage]="cadastroForm.get('dataDeNascimento')?.touched && cadastroForm.get('dataDeNascimento')?.invalid ? 'Data de nascimento é obrigatória.' : null"
        ></app-custom-input>

        <app-custom-input
          label="CNS"
          formControlName="cns"
          type="tel"
          placeholder="000 0000 0000 0000"
          [maxlength]="18"
          [errorMessage]="
            cadastroForm.get('cns')?.touched
              ? (cadastroForm.get('cns')?.hasError('required') ? 'CNS é obrigatório.' : cadastroForm.get('cns')?.hasError('pattern') ? 'CNS inválido.' : null)
              : null
          "
        ></app-custom-input>

        <app-custom-input
          label="CPF"
          formControlName="cpf"
          type="tel"
          placeholder="000.000.000-00"
          [maxlength]="14"
          [errorMessage]="
            cadastroForm.get('cpf')?.touched
              ? (cadastroForm.get('cpf')?.hasError('required') ? 'CPF é obrigatório.' : cadastroForm.get('cpf')?.hasError('pattern') ? 'CPF inválido.' : null)
              : null
          "
        ></app-custom-input>

        <app-custom-input
          label="Telefone"
          formControlName="telefone"
          type="tel"
          placeholder="(00) 00000-0000"
          [maxlength]="15"
          [errorMessage]="
            cadastroForm.get('telefone')?.touched
              ? (cadastroForm.get('telefone')?.hasError('required') ? 'Telefone é obrigatório.' : cadastroForm.get('telefone')?.hasError('pattern') ? 'Telefone inválido.' : null)
              : null
          "
        ></app-custom-input>

        <app-custom-input
          label="Senha"
          formControlName="senha"
          type="password"
          placeholder="Mínimo 8 caracteres"
          [errorMessage]="
            cadastroForm.get('senha')?.touched
              ? (cadastroForm.get('senha')?.hasError('required') ? 'Senha é obrigatória.' : cadastroForm.get('senha')?.hasError('passwordComplex') ? 'A senha não atende aos requisitos.' : null)
              : null
          "
        ></app-custom-input>

        <div class="password-feedback-list">
          <ul>
            <li
              *ngFor="let req of passwordRequirements"
              [class.passed]="req.passed && senhaControl?.value"
              [class.failed]="senhaControl?.value && !req.passed"
            >
              <ion-icon
                [name]="req.passed ? 'checkmark-circle' : 'close-circle'"
              ></ion-icon>
              <span>{{ req.message }}</span>
            </li>
          </ul>
        </div>
        <app-custom-input
          label="Confirme a senha"
          formControlName="confirmarSenha"
          type="password"
          placeholder="Repita sua senha"
          [errorMessage]="cadastroForm.get('confirmarSenha')?.touched && cadastroForm.get('confirmarSenha')?.invalid ? 'Confirme sua senha.' : null"
        ></app-custom-input>

        <p
          *ngIf="cadastroForm.touched && cadastroForm.errors?.['senhasNaoConferem']"
          class="erro-msg"
        >
          As senhas não conferem.
        </p>
      </div>

      <ion-button
        type="submit"
        expand="block"
        class="register-button"
        [disabled]="cadastroForm.invalid || isLoading"
      >
        <span *ngIf="!isLoading">Cadastrar</span>
        <ion-spinner *ngIf="isLoading"></ion-spinner>
      </ion-button>
    </form>
  </div>
</ion-content>
