import{a as G}from"./chunk-JPPMYTV5.js";import{B as N,G as H,I as q,J as b,d as F,e as R,g as z,h as D,i as U,k as j,n as B,q as $,u as O}from"./chunk-UPVBF2VF.js";import{C as d,D as o,E as c,F as C,L as v,M as u,N as m,V as T,X as l,Y as p,ga as L,ha as I,i as _,j as f,la as A,oa as E,pa as V,q as r,r as S,t as y,v as P,z as x}from"./chunk-36HGS4EL.js";import{e as h}from"./chunk-JHI3MBHO.js";function X(i,s){if(i&1){let e=v();o(0,"ion-footer",15)(1,"ion-button",16),u("click",function(n){_(e);let a=m(2);return f(a.onCancelClick(n))}),C(2,"ion-icon",17),l(3," Cancelar Agendamento "),c()()}}function Y(i,s){if(i&1){let e=v();o(0,"ion-footer",18)(1,"ion-button",19),u("click",function(n){_(e);let a=m(2);return f(a.onRemoveClick(n))}),C(2,"ion-icon",20),l(3," Remover do Hist\xF3rico "),c()()}}function Z(i,s){if(i&1&&(o(0,"ion-card",1)(1,"ion-card-header",2)(2,"div",3)(3,"div",4),l(4),c(),o(5,"div",5),l(6),c()(),o(7,"div",6)(8,"ion-badge",7),l(9),c()()(),o(10,"ion-card-content",8)(11,"div",9),C(12,"ion-icon",10),o(13,"ion-label")(14,"h2"),l(15),c()()(),o(16,"div",9),C(17,"ion-icon",11),o(18,"ion-label")(19,"h2"),l(20),c(),o(21,"p"),l(22),c()()(),o(23,"div",9),C(24,"ion-icon",12),o(25,"ion-label")(26,"h2"),l(27),c(),o(28,"p"),l(29),c()()()(),x(30,X,4,0,"ion-footer",13)(31,Y,4,0,"ion-footer",14),c()),i&2){let e=m();T("cancelled",e.appointment.status==="Cancelled"),r(4),p(e.formattedDate),r(2),p(e.formattedTime),r(2),d("color",e.statusColor),r(),p(e.formattedStatus),r(6),p(e.appointment.type),r(5),p(e.appointment.doctor.name),r(2),p(e.appointment.doctor.specialty),r(5),p(e.appointment.healthUnit.name),r(2),p(e.appointment.healthUnit.address),r(),d("ngIf",e.appointment.status==="Pending"||e.appointment.status==="Confirmed"),r(),d("ngIf",e.appointment.status==="Cancelled")}}var J=(()=>{let s=class s{constructor(){this.appointment=null,this.cancelClicked=new S,this.removeClicked=new S}get formattedDate(){if(!this.appointment)return"";try{return new Date(this.appointment.dateTime).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"})}catch{return"Data inv\xE1lida"}}get formattedTime(){if(!this.appointment)return"";try{return new Date(this.appointment.dateTime).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"}).replace(":","h")}catch{return"--h--"}}get statusColor(){switch(this.appointment?.status){case"Pending":return"warning";case"Confirmed":return"success";case"Cancelled":return"danger";default:return"medium"}}get formattedStatus(){if(!this.appointment)return"";switch(this.appointment.status){case"Pending":return"Pendente";case"Confirmed":return"Confirmado";case"Cancelled":return"Cancelado";default:return this.appointment.status}}onCancelClick(t){t.stopPropagation(),this.cancelClicked.emit(this.appointment?._id)}onRemoveClick(t){t.stopPropagation(),this.removeClicked.emit(this.appointment?._id)}};s.\u0275fac=function(n){return new(n||s)},s.\u0275cmp=P({type:s,selectors:[["app-appointment-card"]],inputs:{appointment:"appointment"},outputs:{cancelClicked:"cancelClicked",removeClicked:"removeClicked"},decls:1,vars:1,consts:[["class","appointment-card",3,"cancelled",4,"ngIf"],[1,"appointment-card"],[1,"card-header"],[1,"date-time"],[1,"date"],[1,"time"],[1,"status"],["mode","ios",1,"status-chip",3,"color"],[1,"card-content"],[1,"info-item"],["name","medkit-outline","slot","start"],["name","person-outline","slot","start"],["name","business-outline","slot","start"],["class","card-footer",4,"ngIf"],["class","card-footer card-footer-removed",4,"ngIf"],[1,"card-footer"],["fill","clear","color","danger","size","small",3,"click"],["name","close-circle-outline","slot","start"],[1,"card-footer","card-footer-removed"],["fill","clear","color","medium","size","small",3,"click"],["name","trash-outline","slot","start"]],template:function(n,a){n&1&&x(0,Z,32,13,"ion-card",0),n&2&&d("ngIf",a.appointment)},dependencies:[A,I,b,F,R,z,D,U,B,$,O],styles:[".appointment-card[_ngcontent-%COMP%]{margin:12px;border-radius:10px;box-shadow:0 4px 8px #0000000d;transition:opacity .3s ease}.appointment-card.cancelled[_ngcontent-%COMP%]{opacity:.7}.appointment-card.cancelled[_ngcontent-%COMP%]   .card-content[_ngcontent-%COMP%]{opacity:.8}.card-footer[_ngcontent-%COMP%]{display:flex;justify-content:flex-end;padding:0 8px;border-top:1px solid var(--ion-color-step-150, #e0e0e0)}.card-footer.card-footer-removed[_ngcontent-%COMP%]{justify-content:center}.card-footer.card-footer-removed[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--color: var(--ion-color-medium-shade)}.card-header[_ngcontent-%COMP%]{width:100%;display:flex;flex-direction:row;justify-content:space-between;align-items:flex-start;padding:12px 16px;background-color:#9adaff;border-bottom:1px solid var(--ion-color-step-150, #e0e0e0)}.card-header[_ngcontent-%COMP%]   .date-time[_ngcontent-%COMP%]   .date[_ngcontent-%COMP%]{font-size:1.1rem;font-weight:600;color:var(--ion-color-dark)}.card-header[_ngcontent-%COMP%]   .date-time[_ngcontent-%COMP%]   .time[_ngcontent-%COMP%]{font-size:1rem;color:#000;margin-top:8px}.card-header[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .status-chip[_ngcontent-%COMP%]{height:26px;font-size:.75rem;margin:0;display:flex;align-items:center;border-radius:12px}.card-header[_ngcontent-%COMP%]   .status[_ngcontent-%COMP%]   .status-chip[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{padding-left:8px;padding-right:8px}.card-content[_ngcontent-%COMP%]{padding-top:12px;padding-bottom:8px}.card-content[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]{display:flex;align-items:center;margin-bottom:12px}.card-content[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   ion-icon[_ngcontent-%COMP%]{font-size:1.4rem;color:var(--ion-color-medium);margin-right:12px}.card-content[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   h2[_ngcontent-%COMP%]{font-size:1rem;font-weight:600;margin:0}.card-content[_ngcontent-%COMP%]   .info-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]   p[_ngcontent-%COMP%]{font-size:.9rem;color:var(--ion-color-medium);margin:0}"]});let i=s;return i})();function tt(i,s){i&1&&(o(0,"ion-label",5),l(1," Filtrar por: "),c())}function et(i,s){if(i&1){let e=v();o(0,"div",6)(1,"ion-chip",7),u("click",function(){_(e);let n=m();return f(n.selecionarFiltro("Todos"))}),o(2,"ion-label"),l(3,"Todos"),c()(),o(4,"ion-chip",8),u("click",function(){_(e);let n=m();return f(n.selecionarFiltro("Pending"))}),o(5,"ion-label"),l(6,"Pendentes"),c()(),o(7,"ion-chip",9),u("click",function(){_(e);let n=m();return f(n.selecionarFiltro("Confirmed"))}),o(8,"ion-label"),l(9,"Confirmados"),c()(),o(10,"ion-chip",10),u("click",function(){_(e);let n=m();return f(n.selecionarFiltro("Cancelled"))}),o(11,"ion-label"),l(12,"Cancelados"),c()()()}if(i&2){let e=m();r(),d("outline",e.filtroStatusAtivo!=="Todos"),r(3),d("outline",e.filtroStatusAtivo!=="Pending"),r(3),d("outline",e.filtroStatusAtivo!=="Confirmed"),r(3),d("outline",e.filtroStatusAtivo!=="Cancelled")}}function nt(i,s){i&1&&(o(0,"div",11),C(1,"ion-spinner"),c())}function it(i,s){i&1&&(o(0,"div",14)(1,"p"),l(2,"Voc\xEA ainda n\xE3o possui consulta agendadas."),c()())}function ot(i,s){i&1&&(o(0,"div",14)(1,"p"),l(2,"Nenhuma consulta agendada encontrada para este filtro."),c()())}function at(i,s){if(i&1){let e=v();o(0,"app-appointment-card",17),u("cancelClicked",function(n){_(e);let a=m(3);return f(a.promptCancelarAgendamento(n))})("removeClicked",function(n){_(e);let a=m(3);return f(a.promptRemoverAgendamento(n))}),c()}if(i&2){let e=s.$implicit;d("appointment",e)}}function rt(i,s){if(i&1&&(o(0,"div",15),x(1,at,1,1,"app-appointment-card",16),c()),i&2){let e=m(2);r(),d("ngForOf",e.agendamentos)}}function ct(i,s){if(i&1&&(o(0,"div"),x(1,it,3,0,"div",12)(2,ot,3,0,"div",12)(3,rt,2,1,"div",13),c()),i&2){let e=m();r(),d("ngIf",e.agendamentosMaster.length===0),r(),d("ngIf",e.agendamentosMaster.length>0&&e.agendamentos.length===0),r(),d("ngIf",e.agendamentos.length>0)}}var Mt=(()=>{let s=class s{constructor(t,n,a){this.http=t,this.alertController=n,this.toastController=a,this.titulo="Agendamentos",this.API_URL=G,this.agendamentosMaster=[],this.agendamentos=[],this.filtroStatusAtivo="Todos",this.isLoading=!1}ngOnInit(){this.carregarAgendamentos()}carregarAgendamentos(t=null){this.isLoading=!0;let n=this.API_URL+"/appointments";this.http.get(n,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:a=>{let M=a.map(g=>({_id:g._id,dateTime:g.dateTime,type:g.type,status:g.status,doctor:g.doctor,healthUnit:g.healthUnit}));this.agendamentosMaster=M.sort((g,w)=>new Date(g.dateTime).getTime()-new Date(w.dateTime).getTime()).sort((g,w)=>{let k={Pending:1,Confirmed:2,Cancelled:3};return(k[g.status]??999)-(k[w.status]??999)}),this.aplicarFiltro(),this.isLoading=!1,t&&t.target.complete()},error:a=>{console.error("Erro ao buscar agendamentos",a),this.isLoading=!1,t&&t.target.complete(),this.mostrarToast("Falha ao carregar agendamentos.","danger")}})}aplicarFiltro(){this.filtroStatusAtivo==="Todos"?this.agendamentos=[...this.agendamentosMaster]:this.agendamentos=this.agendamentosMaster.filter(t=>t.status===this.filtroStatusAtivo)}selecionarFiltro(t){this.filtroStatusAtivo=t,this.aplicarFiltro()}promptCancelarAgendamento(t){return h(this,null,function*(){yield(yield this.alertController.create({header:"Confirmar Cancelamento",buttons:[{text:"N\xE3o",role:"cancel"},{text:"Sim, cancelar",handler:()=>this.executarCancelamento(t)}]})).present()})}executarCancelamento(t){this.isLoading=!0;let n=`${this.API_URL}/appointments/${t}`;this.http.patch(n,{status:"Cancelled"},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:()=>h(this,null,function*(){this.mostrarToast("Agendamento cancelado com sucesso.","success"),this.carregarAgendamentos()}),error:a=>h(this,null,function*(){let M=a.error?.message||"Erro ao cancelar agendamento.";this.mostrarToast(M,"danger"),this.isLoading=!1})})}promptRemoverAgendamento(t){return h(this,null,function*(){yield(yield this.alertController.create({header:"Remover Agendamento",buttons:[{text:"N\xE3o",role:"cancel"},{text:"Sim, remover",handler:()=>this.executarRemocao(t)}]})).present()})}executarRemocao(t){let n=`${this.API_URL}/appointments/${t}`;this.http.delete(n,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:()=>h(this,null,function*(){this.mostrarToast("Agendamento removido do hist\xF3rico.","success"),this.agendamentosMaster=this.agendamentosMaster.filter(a=>a._id!==t),this.aplicarFiltro()}),error:a=>h(this,null,function*(){let M=a.error?.message||"Erro ao remover agendamento.";this.mostrarToast(M,"danger")})})}mostrarToast(t,n){return h(this,null,function*(){yield(yield this.toastController.create({message:t,duration:2500,position:"top",color:n})).present()})}};s.\u0275fac=function(n){return new(n||s)(y(E),y(H),y(q))},s.\u0275cmp=P({type:s,selectors:[["app-lista-agendamentos"]],inputs:{titulo:"titulo"},decls:7,vars:5,consts:[[1,"section"],["class","filter-label",4,"ngIf"],["class","filter-chips",4,"ngIf"],["style",`
      display: flex;
      justify-content: center;
      align-items: center;
      height: 80%;
    `,4,"ngIf"],[4,"ngIf"],[1,"filter-label"],[1,"filter-chips"],[3,"click","outline"],["color","warning",3,"click","outline"],["color","success",3,"click","outline"],["color","danger",3,"click","outline"],[2,"display","flex","justify-content","center","align-items","center","height","80%"],["style","padding: 20px; text-align: center; color: var(--ion-color-medium)",4,"ngIf"],["class","appointment-list",4,"ngIf"],[2,"padding","20px","text-align","center","color","var(--ion-color-medium)"],[1,"appointment-list"],[3,"appointment","cancelClicked","removeClicked",4,"ngFor","ngForOf"],[3,"cancelClicked","removeClicked","appointment"]],template:function(n,a){n&1&&(o(0,"div",0)(1,"h3"),l(2),c(),x(3,tt,2,0,"ion-label",1)(4,et,13,4,"div",2)(5,nt,2,0,"div",3)(6,ct,4,3,"div",4),c()),n&2&&(r(2),p(a.titulo),r(),d("ngIf",!a.isLoading&&a.agendamentosMaster.length>0),r(),d("ngIf",!a.isLoading&&a.agendamentosMaster.length>0),r(),d("ngIf",a.isLoading),r(),d("ngIf",!a.isLoading))},dependencies:[A,L,I,b,j,O,N,V,J],styles:[".section[_ngcontent-%COMP%]{padding-left:16px;padding-right:16px;margin-bottom:24px}.section[_ngcontent-%COMP%]   h3[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em;color:var(--app-color-primary-dark);margin:0}.filter-label[_ngcontent-%COMP%]{font-size:.9rem;font-weight:500;color:var(--ion-color-medium-shade);display:block;padding:0 8px;margin-top:4px}.filter-chips[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;padding:0 8px;margin-bottom:8px}.filter-chips[_ngcontent-%COMP%]   ion-chip[_ngcontent-%COMP%]{height:26px;font-size:.75rem;margin-right:6px;margin-bottom:4px}"]});let i=s;return i})();export{J as a,Mt as b};
