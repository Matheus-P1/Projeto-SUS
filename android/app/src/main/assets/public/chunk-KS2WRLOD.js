import{a as ue,b as ge}from"./chunk-S4FL77LE.js";import{a as ce}from"./chunk-JPPMYTV5.js";import{A as me,B as P,E as pe,J as L,b as ee,e as te,g as ie,h as oe,m as re,n as ae,q as ne,t as se,u as le,z as de}from"./chunk-UPVBF2VF.js";import{A as X}from"./chunk-TVNTLNBO.js";import{C as s,D as l,E as a,F as u,L as F,M as x,N as A,U,V as H,X as p,Z as C,bb as R,c as D,ca as N,db as E,e as v,eb as $,fb as z,ga as q,ha as w,hb as Z,i as h,ib as Y,j as f,jb as J,la as M,mb as K,nb as Q,oa as G,ob as W,pa as j,q as n,sa as B,t as y,v as S,w as b,xa as O,z as _}from"./chunk-36HGS4EL.js";import"./chunk-LUUFI6RM.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AHGHMOHV.js";import"./chunk-73NUNHON.js";import"./chunk-4MO7OQZX.js";import"./chunk-UDOB3VRE.js";import"./chunk-M2Y4VNJU.js";import"./chunk-74SSSF5Y.js";import"./chunk-N3KGO5P4.js";import"./chunk-7FY2OE2O.js";import"./chunk-J5AYYYYG.js";import"./chunk-FGNDF6E2.js";import"./chunk-FHHGKWYB.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-ZZTMQJLL.js";import"./chunk-CKP3SGE2.js";import"./chunk-WER6QGNK.js";import"./chunk-WE77HQDE.js";import"./chunk-2GDOKXI3.js";import"./chunk-6O2VLVOF.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-4WFVMWDK.js";import"./chunk-M2X7KQLB.js";import"./chunk-DVVH2KKN.js";import"./chunk-NV3QH4JK.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as I}from"./chunk-JHI3MBHO.js";function Ce(r,i){r&1&&u(0,"ion-spinner",5)}function Ee(r,i){if(r&1&&(l(0,"ion-select-option",8),p(1),a()),r&2){let m=i.$implicit;s("value",m.value),n(),C(" ",m.text," ")}}function Ie(r,i){if(r&1){let m=F();l(0,"ion-select",6),x("ionChange",function(t){h(m);let o=A();return f(o.onValueChange(t))}),_(1,Ee,2,2,"ion-select-option",7),a()}if(r&2){let m=A();s("label",m.label)("value",m.value)("placeholder",m.placeholder)("disabled",m.disabled),n(),s("ngForOf",m.options)}}function Se(r,i){if(r&1&&(l(0,"div",9),p(1),a()),r&2){let m=A();n(),C(" ",m.error," ")}}var he=(()=>{let i=class i{constructor(){this.label="Selecionar",this.options=[],this.loading=!1,this.error=null,this.placeholder="Selecione uma op\xE7\xE3o",this.value=null,this.disabled=!1,this.onChange=e=>{},this.onTouched=()=>{}}writeValue(e){this.value=e}registerOnChange(e){this.onChange=e}registerOnTouched(e){this.onTouched=e}setDisabledState(e){this.disabled=e}onValueChange(e){let t=e.detail.value;this.value=t,this.onChange(t),this.onTouched()}};i.\u0275fac=function(t){return new(t||i)},i.\u0275cmp=S({type:i,selectors:[["app-api-select"]],inputs:{label:"label",options:"options",loading:"loading",error:"error",placeholder:"placeholder"},standalone:!1,features:[N([{provide:R,useExisting:D(()=>i),multi:!0}])],decls:5,vars:7,consts:[[1,"api-select-wrapper"],[1,"api-select-item"],["name","crescent","class","loading-spinner",4,"ngIf"],["interface","action-sheet","class","api-select",3,"label","value","placeholder","disabled","ionChange",4,"ngIf"],["class","error-message",4,"ngIf"],["name","crescent",1,"loading-spinner"],["interface","action-sheet",1,"api-select",3,"ionChange","label","value","placeholder","disabled"],[3,"value",4,"ngFor","ngForOf"],[3,"value"],[1,"error-message"]],template:function(t,o){t&1&&(l(0,"div",0)(1,"ion-item",1),_(2,Ce,1,0,"ion-spinner",2)(3,Ie,2,5,"ion-select",3),a(),_(4,Se,2,1,"div",4),a()),t&2&&(n(),H("ion-invalid",o.error)("ion-touched",o.error),n(),s("ngIf",o.loading),n(),s("ngIf",!o.loading),n(),s("ngIf",o.error))},dependencies:[q,w,se,de,me,P,ee],styles:[".api-select-wrapper[_ngcontent-%COMP%]{width:100%}.api-select-item[_ngcontent-%COMP%]{position:relative;--background: var(--app-color-primary-medium);--border-width: 0px;--inner-border-width: 0px;--highlight-background: transparent;border-radius:8px;margin-bottom:4px}.api-select-item[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-weight:500;color:var(--ion-color-dark)}.loading-spinner[_ngcontent-%COMP%]{position:absolute;right:16px;top:50%;transform:translateY(-50%);z-index:2;width:20px;height:20px}.error-message[_ngcontent-%COMP%]{font-size:.8rem;color:var(--ion-color-danger);--background: var(--app-color-primary-medium);padding:4px 16px 8px;margin-top:-8px;border-bottom-left-radius:8px;border-bottom-right-radius:8px}"]});let r=i;return r})();function Ae(r,i){r&1&&u(0,"ion-spinner",17)}function we(r,i){r&1&&(l(0,"span"),p(1,"Agendar Exame"),a())}var fe=(()=>{let i=class i{constructor(e,t,o,d){this.toastController=e,this.fb=t,this.http=o,this.router=d,this.API_URL=ce,this.tipoExame="",this.unidade="",this.arquivoGuia=null,this.nomeArquivoGuia="Carregar arquivo",this.listaDeExamsFromApi=[],this.listaDeExames=[],this.listaDeUnidades=[],this.listaDeHorarios=[],this.isLoadingExames=!1,this.isLoadingUnidades=!1,this.isLoadingHorarios=!1,this.isLoadingAgendamento=!1}ngOnInit(){this.myForm=this.fb.group({unidade:[null,[E.required]],exame:[{value:null,disabled:!0},[E.required]],horario:[{value:null,disabled:!0},[E.required]],guia:[null,[E.required]]}),this.myForm.get("unidade")?.valueChanges.subscribe(e=>{let t=this.myForm.get("exame");t?.setValue(null),e?(t?.enable(),this.carregarExames()):(t?.disable(),this.listaDeExames=[])}),this.myForm.get("exame")?.valueChanges.subscribe(e=>{let t=this.myForm.get("horario");t?.setValue(null),e&&this.listaDeExamsFromApi.length>0?(t?.enable(),this.carregarHorarios(this.listaDeExamsFromApi)):(t?.disable(),this.listaDeHorarios=[])}),this.carregarUnidade()}carregarUnidade(){this.isLoadingUnidades=!0;let e=this.API_URL+"/health-units/with-exams";this.http.get(e,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:t=>{this.isLoadingUnidades=!1,this.listaDeUnidades=t.map(o=>({text:o.name,value:o._id}))},error:t=>{this.isLoadingUnidades=!1,this.presentarToast("Erro ao carregar unidades de sa\xFAde. Tente novamente mais tarde.","danger")}})}carregarHorarios(e){this.isLoadingHorarios=!0;let t=this.myForm.get("exame")?.value,o=e.find(c=>c.examId===t);if(!o){this.isLoadingHorarios=!1;return}let d=[];o.availability.forEach(c=>{c.times.forEach(g=>{let k=new Date(c.date).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric"}),be=new Date(`1970-01-01T${g}Z`).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit",timeZone:"UTC"});d.push({text:`${k} - ${be}`,value:`${c._id}|${g}`})})}),this.listaDeHorarios=d,this.isLoadingHorarios=!1}carregarExames(){this.isLoadingExames=!0;let e=this.myForm.get("unidade")?.value;if(!e){this.isLoadingExames=!1;return}let t=this.API_URL+`/health-units/${e}/exams`;this.http.get(t,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:o=>{this.isLoadingExames=!1,this.listaDeExamsFromApi=o,this.listaDeExames=o.map(d=>({text:d.examName,value:d.examId})),this.isLoadingExames=!1},error:o=>{this.isLoadingExames=!1,this.presentarToast("Erro ao carregar tipos de exames. Tente novamente mais tarde.","danger")}})}getExameSelectErrorMessage(){let e=this.myForm.get("exame");return e&&e.touched&&e.hasError("required")?"Voc\xEA precisa selecionar um exame.":null}getUnidadeSelectErrorMessage(){let e=this.myForm.get("unidade");return e&&e.touched&&e.hasError("required")?"Voc\xEA precisa selecionar uma unidade de sa\xFAde.":null}getHorarioSelectErrorMessage(){let e=this.myForm.get("horario");return e&&e.touched&&e.hasError("required")?"Voc\xEA precisa selecionar um hor\xE1rio para o exame.":null}criarAgendamento(){let e=this.API_URL+"/exams";this.isLoadingAgendamento=!0;let t=this.myForm.get("exame")?.value,o=this.myForm.get("horario")?.value?.split("|")[0],d=this.myForm.get("horario")?.value?.split("|")[1],g={healthUnitId:this.myForm.get("unidade")?.value,availabilityId:o,time:d,examId:t};this.http.post(e,g,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:()=>I(this,null,function*(){this.isLoadingAgendamento=!1,yield this.presentarToast("Exame agendado com sucesso!","success"),this.myForm.get("horario")?.setValue(null),this.myForm.get("exame")?.setValue(null),this.myForm.get("unidade")?.setValue(null),this.myForm.get("guia")?.setValue(null),this.arquivoGuia=null,this.nomeArquivoGuia="Anexar foto da guia",this.router.navigate(["/meus-agendamentos"])}),error:V=>I(this,null,function*(){this.isLoadingAgendamento=!1;let k=V.error?.message||"Erro ao agendar exame. Tente novamente.";yield this.presentarToast(k,"danger")})})}onFileSelected(e){let t=e.target.files[0];t&&(this.myForm.patchValue({guia:t}),this.arquivoGuia=t,this.nomeArquivoGuia=t.name)}agendar(){if(this.myForm.invalid){this.myForm.get("exame")?.hasError("required")?this.presentarToast("Por favor, informe o tipo de exame.","danger"):this.myForm.get("guia")?.hasError("required")?this.presentarToast("Por favor, anexe a foto da guia.","danger"):this.myForm.get("unidade")?.hasError("required")?this.presentarToast("Por favor, escolha uma unidade.","danger"):this.presentarToast("Por favor, preencha todos os campos.","danger");return}}presentarToast(e,t){return I(this,null,function*(){(yield this.toastController.create({message:e,duration:3e3,position:"bottom",color:t})).present()})}};i.\u0275fac=function(t){return new(t||i)(y(X),y(K),y(G),y(B))},i.\u0275cmp=S({type:i,selectors:[["app-agendar-exames"]],standalone:!1,decls:35,vars:15,consts:[["fileUploadInput",""],["titulo","Agendar Exame"],[3,"fullscreen"],[3,"ngSubmit","formGroup"],[1,"content-padding"],[1,"page-title"],[1,"search-card"],["label","Unidade de Sa\xFAde","placeholder","Buscar unidade...","formControlName","unidade",3,"loading","options","error"],["label","Exame","placeholder","Buscar exame...","formControlName","exame",3,"loading","options","error"],["label","Hor\xE1rio do Exame","placeholder","Buscar hor\xE1rio...","formControlName","horario",3,"loading","options","error"],["type","file","accept","image/png, image/jpeg, application/pdf",2,"display","none",3,"change"],["expand","full","type","button",1,"upload-button",3,"click"],["slot","start","name","cloud-upload-outline"],[1,"ion-no-border"],["type","submit","expand","full",1,"agendar-button",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["name","crescent"]],template:function(t,o){if(t&1){let d=F();u(0,"app-simple-header",1),l(1,"ion-content",2)(2,"form",3),x("ngSubmit",function(){return h(d),f(o.agendar())}),l(3,"div",4)(4,"h3",5),p(5,"Agendar Exame"),a(),l(6,"ion-card",6)(7,"ion-card-content")(8,"ion-label"),p(9,"Escolha uma unidade de sa\xFAde:"),a(),u(10,"app-api-select",7),a()(),l(11,"ion-card",6)(12,"ion-card-content")(13,"ion-label"),p(14,"Tipo de exame:"),a(),u(15,"app-api-select",8),a()(),l(16,"ion-card",6)(17,"ion-card-content")(18,"ion-label"),p(19,"Hor\xE1rio do exame:"),a(),u(20,"app-api-select",9),a()(),l(21,"ion-card",6)(22,"ion-card-content")(23,"ion-label"),p(24,"Anexar foto da guia:"),a(),l(25,"input",10,0),x("change",function(g){return h(d),f(o.onFileSelected(g))}),a(),l(27,"ion-button",11),x("click",function(){h(d);let g=U(26);return f(g.click())}),u(28,"ion-icon",12),p(29),a()()()()()(),l(30,"ion-footer",13)(31,"ion-toolbar")(32,"ion-button",14),x("click",function(){return h(d),f(o.criarAgendamento())}),_(33,Ae,1,0,"ion-spinner",15)(34,we,2,0,"span",16),a()()()}t&2&&(n(),s("fullscreen",!0),n(),s("formGroup",o.myForm),n(8),s("loading",o.isLoadingUnidades)("options",o.listaDeUnidades)("error",o.getExameSelectErrorMessage()),n(5),s("loading",o.isLoadingExames)("options",o.listaDeExames)("error",o.getExameSelectErrorMessage()),n(5),s("loading",o.isLoadingHorarios)("options",o.listaDeHorarios)("error",o.getHorarioSelectErrorMessage()),n(9),C(" ",o.nomeArquivoGuia," "),n(3),s("disabled",o.myForm.invalid||o.isLoadingAgendamento||o.isLoadingExames||o.isLoadingHorarios||o.isLoadingUnidades),n(),s("ngIf",o.isLoadingAgendamento),n(),s("ngIf",!o.isLoadingAgendamento))},dependencies:[w,Z,$,z,Y,J,te,ie,oe,re,ae,ne,le,P,pe,ue,he],styles:["ion-toolbar[_ngcontent-%COMP%]{--background: var(--app-color-header-bg)}ion-title[_ngcontent-%COMP%]{color:var(--app-color-primary-dark);font-weight:700}ion-back-button[_ngcontent-%COMP%]{color:var(--app-color-primary-dark)}ion-content[_ngcontent-%COMP%]{--background: var(--app-color-white)}.content-padding[_ngcontent-%COMP%]{padding:0 16px}.page-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em;color:var(--app-color-primary-dark);margin-bottom:24px;padding-left:4px}.search-card[_ngcontent-%COMP%]{--background: #f0f0f0;box-shadow:none;border-radius:8px;margin:0 0 20px;padding:8px 0}.search-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0 8px}.search-card[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.9em;font-weight:500;color:#333;padding-left:8px;margin-bottom:8px;display:block}.custom-searchbar[_ngcontent-%COMP%]{--background: var(--app-color-primary-medium);--box-shadow: none;--border-radius: 8px;padding:0;margin:0;--color: var(--app-color-primary-dark);--placeholder-color: var(--app-color-primary-dark);--icon-color: var(--app-color-primary-dark)}.upload-button[_ngcontent-%COMP%]{--background: var(--app-color-primary-medium);--color: var(--app-color-primary-dark);--border-radius: 8px;--box-shadow: none;font-weight:500;height:44px;margin:0;font-size:.9em;text-transform:none}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--app-color-white);padding:10px 16px}.agendar-button[_ngcontent-%COMP%]{--background: var(--app-color-primary-medium);--color: var(--app-color-primary-dark);--border-radius: 8px;--box-shadow: none;font-weight:700;height:48px;margin:0}"]});let r=i;return r})();var xe=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=b({type:i}),i.\u0275inj=v({imports:[M,L]});let r=i;return r})();var Me=[{path:"",component:fe}],ve=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=b({type:i}),i.\u0275inj=v({imports:[O.forChild(Me),O]});let r=i;return r})();var nt=(()=>{let i=class i{};i.\u0275fac=function(t){return new(t||i)},i.\u0275mod=b({type:i}),i.\u0275inj=v({imports:[M,Q,W,L,ve,ge,xe,j]});let r=i;return r})();export{nt as AgendarExamesPageModule};
