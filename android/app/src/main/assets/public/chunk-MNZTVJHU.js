import{a as le,b as ce}from"./chunk-S4FL77LE.js";import{a as se}from"./chunk-JPPMYTV5.js";import{B as oe,E as ne,G as ae,I as re,J as A,c as Q,e as S,g as X,h as Y,m as ee,n as te,u as O,y as ie}from"./chunk-UPVBF2VF.js";import{$ as D,C as d,D as s,E as r,F as w,L as y,M as C,N as p,X as m,Y as T,Z as E,_ as B,aa as U,ba as z,da as j,e as v,eb as K,fa as N,ga as P,gb as G,ha as $,i as h,j as u,la as I,nb as J,oa as W,pa as Z,q as l,r as R,sa as q,t as x,v as b,w as M,xa as F,z as f}from"./chunk-36HGS4EL.js";import"./chunk-LUUFI6RM.js";import"./chunk-QUJFQN2Y.js";import"./chunk-AHGHMOHV.js";import"./chunk-73NUNHON.js";import"./chunk-4MO7OQZX.js";import"./chunk-M2Y4VNJU.js";import"./chunk-74SSSF5Y.js";import"./chunk-N3KGO5P4.js";import"./chunk-7FY2OE2O.js";import"./chunk-J5AYYYYG.js";import"./chunk-FGNDF6E2.js";import"./chunk-FHHGKWYB.js";import"./chunk-MTHZ7MWU.js";import"./chunk-WI5MSH4N.js";import"./chunk-ZZTMQJLL.js";import"./chunk-CKP3SGE2.js";import"./chunk-WER6QGNK.js";import"./chunk-WE77HQDE.js";import"./chunk-2GDOKXI3.js";import"./chunk-6O2VLVOF.js";import"./chunk-JVTPOORY.js";import"./chunk-CLDSZD2A.js";import"./chunk-M2X7KQLB.js";import"./chunk-2F44PKVT.js";import"./chunk-OZYWYLNK.js";import"./chunk-42C7ZIID.js";import{e as _}from"./chunk-JHI3MBHO.js";function ge(o,t){if(o&1){let a=y();s(0,"ion-button",10),C("click",function(){let e=h(a).$implicit,i=p();return u(i.selectSlot(e))}),m(1),r()}if(o&2){let a=t.$implicit,n=p();d("fill",a===n.selectedSlot?"solid":"outline"),l(),E(" ",a.item," ")}}var k=(()=>{let t=class t{constructor(){this.name="",this.specialty="",this.crm="",this.availability=[],this.healthUnit=null,this.selectedSlot=null,this.slotSelected=new R}selectSlot(n){this.slotSelected.emit(n)}};t.\u0275fac=function(e){return new(e||t)},t.\u0275cmp=b({type:t,selectors:[["app-doctor-card"]],inputs:{name:"name",specialty:"specialty",crm:"crm",availability:"availability",healthUnit:"healthUnit",selectedSlot:"selectedSlot"},outputs:{slotSelected:"slotSelected"},decls:15,vars:6,consts:[[1,"doctor-card-container"],[1,"info-section"],[1,"doctor-name"],[1,"doctor-specialty"],[1,"doctor-crm"],[1,"doctor-location"],[1,"availability-section"],[1,"section-title"],[1,"slots-container"],["size","small",3,"fill","click",4,"ngFor","ngForOf"],["size","small",3,"click","fill"]],template:function(e,i){e&1&&(s(0,"div",0)(1,"div",1)(2,"h2",2),m(3),r(),s(4,"p",3),m(5),r(),s(6,"p",4),m(7),r(),s(8,"p",5),m(9),r()(),s(10,"div",6)(11,"ion-label",7),m(12,"Dias e Hor\xE1rios Dispon\xEDveis"),r(),s(13,"div",8),f(14,ge,2,2,"ion-button",9),r()()()),e&2&&(l(3),T(i.name),l(2),T(i.specialty),l(2),E("CRM: ",i.crm),l(2),B(" Local: ",i.healthUnit==null?null:i.healthUnit.name," - ",i.healthUnit==null?null:i.healthUnit.address," "),l(5),d("ngForOf",i.availability))},dependencies:[I,P,A,S,O],styles:[".doctor-card-container[_ngcontent-%COMP%]{background:var(--ion-color-light, #f4f4f4);border-radius:8px;padding:16px;margin:12px;box-shadow:0 4px 8px #0000000d;font-family:Arial,sans-serif}.info-section[_ngcontent-%COMP%]   .doctor-name[_ngcontent-%COMP%]{font-size:1.3rem;font-weight:700;color:#333;margin:0 0 4px}.info-section[_ngcontent-%COMP%]   .doctor-specialty[_ngcontent-%COMP%], .info-section[_ngcontent-%COMP%]   .doctor-crm[_ngcontent-%COMP%]{font-size:1rem;color:var(--ion-color-medium-shade, #777);margin:0 0 4px}.info-section[_ngcontent-%COMP%]   .doctor-location[_ngcontent-%COMP%]{font-size:1rem;color:#333;font-weight:500;margin-top:12px}.availability-section[_ngcontent-%COMP%]{margin-top:16px}.availability-section[_ngcontent-%COMP%]   .section-title[_ngcontent-%COMP%]{font-size:.9rem;font-weight:600;color:var(--ion-color-medium-shade, #777);display:block;margin-bottom:12px}.availability-section[_ngcontent-%COMP%]   .slots-container[_ngcontent-%COMP%]{display:flex;flex-wrap:wrap;gap:4px}.availability-section[_ngcontent-%COMP%]   ion-button[_ngcontent-%COMP%]{--border-radius: 20px;font-size:.9rem}"]});let o=t;return o})();function ue(o,t){o&1&&(s(0,"div",5),w(1,"ion-spinner"),r())}function fe(o,t){o&1&&(s(0,"div",12),m(1," Nenhum profissional encontrado. "),r())}function _e(o,t){if(o&1){let a=y();s(0,"app-doctor-card",15),C("slotSelected",function(e){let i=h(a).$implicit,c=p(3);return u(c.onHorarioSelecionado(i,e))}),r()}if(o&2){let a=t.$implicit,n=p(3);d("name",a.name)("specialty",a.specialty)("crm",a.crm)("availability",a.availability)("healthUnit",a.healthUnit)("selectedSlot",n.selectedHorario)}}function Ce(o,t){if(o&1&&(s(0,"div",13),f(1,_e,1,6,"app-doctor-card",14),r()),o&2){let a=p(2);l(),d("ngForOf",a.medicosParaRenderizar)}}function xe(o,t){if(o&1){let a=y();s(0,"div",6)(1,"h3",7),m(2,"Busque Pelo profissional e especialidade"),r(),s(3,"ion-card",8)(4,"ion-card-content")(5,"ion-label"),m(6,"Especialidade:"),r(),s(7,"ion-searchbar",9),z("ngModelChange",function(e){h(a);let i=p();return U(i.especialidade,e)||(i.especialidade=e),u(e)}),C("ionInput",function(){h(a);let e=p();return u(e.onFilterChange())}),r()()(),s(8,"ion-card",8)(9,"ion-card-content")(10,"ion-label"),m(11,"Nome do Profissional:"),r(),s(12,"ion-searchbar",9),z("ngModelChange",function(e){h(a);let i=p();return U(i.profissional,e)||(i.profissional=e),u(e)}),C("ionInput",function(){h(a);let e=p();return u(e.onFilterChange())}),r()()(),f(13,fe,2,0,"div",10)(14,Ce,2,1,"div",11),r()}if(o&2){let a=p();l(7),D("ngModel",a.especialidade),l(5),D("ngModel",a.profissional),l(),d("ngIf",a.medicosParaRenderizar.length===0),l(),d("ngIf",a.medicosParaRenderizar.length>0)}}function ye(o,t){o&1&&w(0,"ion-spinner",20)}function ve(o,t){o&1&&(s(0,"span"),m(1,"Agendar Consulta"),r())}function be(o,t){if(o&1){let a=y();s(0,"ion-footer",16)(1,"ion-toolbar")(2,"ion-button",17),C("click",function(){h(a);let e=p();return u(e.agendar())}),f(3,ye,1,0,"ion-spinner",18)(4,ve,2,0,"span",19),r()()()}if(o&2){let a=p();l(2),d("disabled",!a.selectedHorario||a.isLoadingAgendarConsulta),l(),d("ngIf",a.isLoadingAgendarConsulta),l(),d("ngIf",!a.isLoadingAgendarConsulta)}}var L=(()=>{let t=class t{constructor(n,e,i,c,g){this.alertController=n,this.location=e,this.http=i,this.router=c,this.toastController=g,this.API_URL=se,this.especialidade="",this.profissional="",this.medicosParaRenderizar=[],this.medicosDaApi=[],this.selectedMedico=null,this.selectedHorario=null,this.disabled=!1,this.isLoading=!1,this.isLoadingAgendarConsulta=!1}ngOnInit(){this.isLoading=!0,this.getDoctors(),console.log({med:this.selectedMedico,horario:this.selectedHorario})}ngOnDestroy(){this.especialidade="",this.profissional="",this.medicosParaRenderizar=[],this.selectedMedico=null,this.selectedHorario=null,clearTimeout(this.filterTimer)}getDoctors(){let n=this.API_URL+"/doctors";this.isLoading=!0,this.http.get(n,{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:e=>{this.medicosParaRenderizar=e.map(i=>({_id:i._id,crm:i.crm,name:i.name,specialty:i.specialty,healthUnit:i.healthUnit,availability:i.availability.map(c=>c.times.map(g=>({id:c._id,time:g,item:`${this.formatarData(c.date)} - ${this.formatarHora(g)}`}))).flat()})),this.isLoading=!1},error:e=>{this.isLoading=!1}})}goBack(){this.location.back()}onFilterChange(){clearTimeout(this.filterTimer),this.filterTimer=setTimeout(()=>{this.buscar()},300)}buscar(){if(this.selectedHorario=null,this.selectedMedico=null,!this.especialidade&&!this.profissional){this.getDoctors();return}let n=this.especialidade.toLowerCase(),e=this.profissional.toLowerCase(),i=this.medicosParaRenderizar.filter(c=>{let g=!this.especialidade||c.specialty.toLowerCase().includes(n),V=!this.profissional||c.name.toLowerCase().includes(e);return g&&V});this.medicosParaRenderizar=i}onHorarioSelecionado(n,e){this.selectedMedico=n,this.selectedHorario=e}exibirAlerta(n){return _(this,null,function*(){yield(yield this.alertController.create({header:"Aviso",message:n,buttons:["OK"]})).present()})}agendar(){return _(this,null,function*(){if(!this.selectedMedico||!this.selectedHorario){this.exibirAlerta("Por favor, selecione um profissional e um hor\xE1rio.");return}yield(yield this.alertController.create({header:"Confirmar Agendamento",message:`
        Deseja agendar com ${this.selectedMedico.name}
        na: ${this.selectedHorario.item}?
      `,buttons:[{text:"Cancelar",role:"cancel"},{text:"Confirmar",handler:()=>_(this,null,function*(){yield this.agendarConsulta({medico:this.selectedMedico,horario:this.selectedHorario})})}]})).present()})}agendarConsulta(n){return _(this,null,function*(){let e=this.API_URL+"/appointments";this.isLoadingAgendarConsulta=!0,this.http.post(e,{type:"Consulta",doctorId:n.medico._id,healthUnitId:n.medico.healthUnit._id,availabilityId:n.horario.id,time:n.horario.time},{headers:{Authorization:`Bearer ${localStorage.getItem("token")}`}}).subscribe({next:i=>_(this,null,function*(){this.isLoadingAgendarConsulta=!1,yield(yield this.toastController.create({message:"Consulta agendada com sucesso!",duration:2e3,position:"top",color:"success"})).present(),this.selectedHorario=null,this.selectedMedico=null,this.especialidade="",this.profissional="",this.router.navigate(["/meus-agendamentos"])}),error:i=>_(this,null,function*(){this.isLoadingAgendarConsulta=!1;let c=i.error?.message||"Erro ao agendar consulta. Tente novamente.";yield(yield this.toastController.create({message:c,duration:2e3,position:"top",color:"danger"})).present()})})})}formatarData(n){let e=new Date(n+"T00:00:00Z"),i=e.toLocaleDateString("pt-BR",{weekday:"short",timeZone:"UTC"}).replace(".",""),c=e.toLocaleDateString("pt-BR",{day:"2-digit",timeZone:"UTC"}),g=e.toLocaleDateString("pt-BR",{month:"2-digit",timeZone:"UTC"});return`${i.charAt(0).toUpperCase()+i.slice(1)}, ${c}/${g}`}formatarHora(n){return n.replace(":","h")}};t.\u0275fac=function(e){return new(e||t)(x(ae),x(N),x(W),x(q),x(re))},t.\u0275cmp=b({type:t,selectors:[["app-agendar-consulta"]],standalone:!1,decls:5,vars:4,consts:[["titulo","Agendar Consulta"],[3,"fullscreen"],["style",`
      display: flex;
      justify-content: center;
      align-items: center;
      height: 100%;
    `,4,"ngIf"],["class","content-padding",4,"ngIf"],["class","ion-no-border",4,"ngIf"],[2,"display","flex","justify-content","center","align-items","center","height","100%"],[1,"content-padding"],[1,"page-title"],[1,"search-card"],["placeholder","Buscar",1,"custom-searchbar",3,"ngModelChange","ionInput","ngModel"],["style","padding: 16px; text-align: center; color: var(--ion-color-medium)",4,"ngIf"],["class","results-list",4,"ngIf"],[2,"padding","16px","text-align","center","color","var(--ion-color-medium)"],[1,"results-list"],[3,"name","specialty","crm","availability","healthUnit","selectedSlot","slotSelected",4,"ngFor","ngForOf"],[3,"slotSelected","name","specialty","crm","availability","healthUnit","selectedSlot"],[1,"ion-no-border"],["color","primary","expand","full",1,"button",3,"click","disabled"],["name","crescent",4,"ngIf"],[4,"ngIf"],["name","crescent"]],template:function(e,i){e&1&&(w(0,"app-simple-header",0),s(1,"ion-content",1),f(2,ue,2,0,"div",2)(3,xe,15,4,"div",3),r(),f(4,be,5,3,"ion-footer",4)),e&2&&(l(),d("fullscreen",!0),l(),d("ngIf",i.isLoading),l(),d("ngIf",!i.isLoading),l(),d("ngIf",!i.isLoading))},styles:["ion-toolbar[_ngcontent-%COMP%]{--background: var(--app-color-header-bg)}ion-title[_ngcontent-%COMP%]{color:var(--app-color-primary-dark);font-weight:700}ion-back-button[_ngcontent-%COMP%]{color:var(--app-color-primary-dark)}ion-content[_ngcontent-%COMP%]{--background: var(--app-color-white)}.content-padding[_ngcontent-%COMP%]{padding:0 16px}.page-title[_ngcontent-%COMP%]{font-weight:700;font-size:1.1em;color:var(--app-color-primary-dark);margin-bottom:24px;padding-left:4px}.search-card[_ngcontent-%COMP%]{--background: #f0f0f0;box-shadow:none;border-radius:8px;margin:0 0 20px;padding:8px 0}.search-card[_ngcontent-%COMP%]   ion-card-content[_ngcontent-%COMP%]{padding:0 8px}.search-card[_ngcontent-%COMP%]   ion-label[_ngcontent-%COMP%]{font-size:.9em;font-weight:500;color:#333;padding-left:8px;margin-bottom:8px;display:block}.custom-searchbar[_ngcontent-%COMP%]{--background: var(--app-color-primary-medium);--box-shadow: none;--border-radius: 8px;padding:0;margin:0;--color: var(--app-color-primary-dark);--placeholder-color: var(--app-color-primary-dark);--icon-color: var(--app-color-primary-dark)}ion-footer[_ngcontent-%COMP%]   ion-toolbar[_ngcontent-%COMP%]{--background: var(--app-color-white);padding:10px 16px}button[_ngcontent-%COMP%]{--background: var(--app-color-primary-medium);--color: var(--app-color-primary-dark);--box-shadow: none;font-weight:700;border-radius:8px;height:48px;margin:0}"]});let o=t;return o})();var Me=[{path:"",component:L}],me=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=M({type:t}),t.\u0275inj=v({imports:[F.forChild(Me),F]});let o=t;return o})();var Ke=(()=>{let t=class t{};t.\u0275fac=function(e){return new(e||t)},t.\u0275mod=M({type:t}),t.\u0275inj=v({imports:[I,J,Z,A,me,k,ce]});let o=t;return o})();j(L,[P,$,K,G,S,X,Y,ee,te,O,ie,oe,ne,Q,k,le],[]);export{Ke as AgendarConsultaPageModule};
